<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Rajin 21-Day Shiva Fast & Prayer Tracker</title>
    <style>
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#f0e6d2 0%,#f8f4e5 100%);margin:0;padding:12px 10px 30px;color:#2f2f2f;line-height:1.65;user-select:none}.container{max-width:600px;margin:0 auto;background:#fffefc;padding:28px 30px 30px;border-radius:18px;box-shadow:0 12px 35px rgba(211,138,23,0.3);border:2px solid #d67a12;transition:box-shadow 0.4s ease}.container:hover{box-shadow:0 18px 45px rgba(211,138,23,0.45)}h1{color:#c85c00;text-align:center;margin-bottom:8px;font-size:2.3em;font-weight:700;letter-spacing:1.2px;text-shadow:1px 1px 3px #d67a12cc}.subtitle{text-align:center;color:#8a8a8a;margin-bottom:28px;font-size:1.1em;font-style:italic}.countdown{text-align:center;font-size:1.2em;margin:22px 0 30px;padding:14px 0;background:#d35400;color:#fff;border-radius:12px;font-weight:700;letter-spacing:0.06em;box-shadow:0 3px 10px rgba(211,84,0,0.7);user-select:text}.progress-container{margin:25px 0 20px;border-radius:14px;overflow:hidden;border:2px solid #d67a12;box-shadow:inset 0 0 7px #d67a12cc}.progress-bar{height:14px;background:#f1e3c9}.progress{height:100%;background:linear-gradient(90deg,#27ae60,#2ecc71);width:0%;transition:width 0.7s ease-in-out;box-shadow:0 0 8px #27ae60cc}.day-info{margin-top:8px;font-size:0.92em;color:#7a7a7a;text-align:center;font-weight:600}.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:7px;margin:28px 0 28px;user-select:none}.calendar-day{border:1.5px solid #d8cda3;padding:12px 5px;text-align:center;border-radius:12px;background:#fcfaf6;font-size:0.95em;position:relative;cursor:pointer;font-weight:600;color:#5e5e5e;box-shadow:0 2px 6px rgba(230,210,180,0.4);transition:transform 0.2s ease,box-shadow 0.3s ease}.calendar-day:hover:not(.future-day){transform:translateY(-4px);box-shadow:0 8px 15px rgba(211,138,23,0.6);border-color:#d67a12;color:#c85c00;font-weight:700}.day-number{font-weight:700;font-size:1.1em}.month-name{font-size:0.7em;color:#8a8a8a;margin-top:2px}.current-day{background:linear-gradient(135deg,#d35400,#e67e22);color:white;font-weight:700;box-shadow:0 4px 12px #e67e2211 inset;border:none;cursor:default;user-select:text}.completed-day{background:#27ae60;color:white;font-weight:700;box-shadow:0 3px 8px #27ae6011 inset;border:none;cursor:default}.future-day{opacity:0.55;cursor:default;user-select:none}#daily-content{user-select:text}#day-title{font-weight:700;color:#2c3e50;font-size:1.35em;margin-bottom:8px;text-align:center;text-shadow:1px 1px 2px #d67a12bb}.mantra{background:#e8f4f8;padding:14px 16px;border-left:5px solid #3498db;margin:12px 0 20px;font-size:1em;line-height:1.5;font-style:italic;color:#2b3e50;border-radius:6px;box-shadow:0 2px 6px #3498db33;user-select:text}.quote{font-style:italic;color:#7f8c8d;margin:18px 0 28px;padding:12px 18px;background:#faf9f7;border-left:5px solid #d35400;border-radius:0 6px 6px 0;font-size:0.95em;box-shadow:0 2px 8px #d3540033;user-select:text}button{background:#e67e22;color:white;border:none;padding:16px 0;border-radius:14px;cursor:pointer;width:100%;font-size:17px;margin-top:20px;font-weight:700;letter-spacing:0.08em;box-shadow:0 4px 15px #e67e2211;transition:background-color 0.3s ease;user-select:none}button:hover{background:#d35400;box-shadow:0 6px 22px #d3540022}button:disabled{background:#95a5a6;cursor:not-allowed;box-shadow:none}#mantra-chant-section{margin:25px 0;background:#f8f9fa;padding:20px;border-radius:12px;border:1px solid #e1d9c8;box-shadow:0 3px 15px rgba(230,126,34,0.1)}#mantra-select{width:100%;padding:12px;font-size:1em;margin-bottom:15px;border-radius:8px;border:1px solid #d8cda3;background:#fff;color:#5e5e5e}#mantra-text{padding:15px;background:#f5f9fa;border-radius:8px;margin-bottom:15px;font-style:italic;line-height:1.6;border-left:4px solid #3498db}#chant-counter{text-align:center;font-weight:600;margin-bottom:10px;color:#2c3e50}#chant-button{background:#3498db;margin-top:10px}#chant-button:hover{background:#2980b9}#chant-message{margin-top:15px;text-align:center;font-weight:600;color:#27ae60;min-height:20px}#clear-btn{background:#c0392b;margin-top:10px}#clear-btn:hover{background:#922b21}.puja-checklist{margin:28px 0;background:#fcfcfc;padding:22px 18px 20px;border-radius:14px;border:1.8px solid #e1d9c8;box-shadow:0 3px 15px #d67a1211}.puja-checklist h2{color:#4b2e83;margin-top:20px;font-size:1.2em;border-bottom:1px solid #e1d9c8;padding-bottom:8px;cursor:pointer}.puja-checklist h3{color:#4b2e83;margin-top:15px;font-size:1.1em;cursor:pointer}.puja-checklist ul{list-style-type:none;padding-left:0}.puja-checklist li{background:#fff;margin:8px 0;padding:10px;border-radius:5px;border-left:5px solid #4b2e83;display:flex;align-items:center}.puja-checklist input[type="checkbox"]{margin-right:10px;transform:scale(1.25)}.collapsible-content {overflow: hidden;transition: max-height 0.2s ease-out;}.collapsed {max-height: 0 !important;}.simple-checklist {margin: 15px 0;}.simple-checklist li {border-left-color: #e67e22;}.preparation-list {background-color: #f8f4e5 !important;border-left-color: #d67a12 !important;}.preparation-list li {background-color: #fff8e1 !important;}.preparation-header {color: #d67a12 !important;}.ritual-list {background-color: #e8f5e9 !important;border-left-color: #27ae60 !important;}.ritual-list li {background-color: #f1f8e9 !important;}@media (max-width:400px){.container{padding:18px 16px 26px}.calendar{grid-template-columns:repeat(4,1fr)}button{font-size:16px}h1{font-size:2em}}
    </style>
</head>
<body>
    <div class="container">
        <h1>Rajin 21-Day Shiva Fast &amp; Prayer Tracker</h1>
        <div class="subtitle">May 27 - June 16, 2025 | May Lord Shiva bless your spiritual journey</div>
        <div class="countdown" id="countdown"></div>
        <div class="progress-container">
            <div class="progress-bar"><div class="progress" id="progress"></div></div>
        </div>
        <div class="day-info" id="day-info"></div>
        <div class="calendar" id="calendar"></div>
        <div id="daily-content">
            <h2 id="day-title">üìø Day 1 of 21 (May 27, 2025)</h2>
            <div class="mantra" id="mantra"></div>
            <div class="quote" id="quote"></div>
            
            <!-- Monday: Rudra Checklist -->
            <div class="puja-checklist" id="monday-checklist" style="display: none;">
                <h2 onclick="toggleChecklist('monday')">üïâÔ∏è Monday: Rudra Puja and Fasting ‚ñº</h2>
                <div id="monday-content" class="collapsible-content">
                    <h3 class="preparation-header" onclick="toggleChecklist('monday-prepare')">üõçÔ∏è Preparation Items (Gather These Before Starting) ‚ñº</h3>
                    <div id="monday-prepare" class="collapsible-content preparation-list">
                        <ul>
                            <li><input type="checkbox" id="monday-items1"> Picture or idol of Shiva (or Shivling if available)</li>
                            <li><input type="checkbox" id="monday-items2"> Clean water (Ganga Jal preferred) or milk for Abhishekam</li>
                            <li><input type="checkbox" id="monday-items3"> Bilva (Bel) leaves - 11 or more if possible</li>
                            <li><input type="checkbox" id="monday-items4"> Diya (oil lamp) with ghee or oil, incense sticks</li>
                            <li><input type="checkbox" id="monday-items5"> Fresh flowers (white or blue preferred)</li>
                            <li><input type="checkbox" id="monday-items6"> Fruits (banana, coconut, or any seasonal fruit)</li>
                            <li><input type="checkbox" id="monday-items7"> Small plate/bowl for offerings</li>
                            <li><input type="checkbox" id="monday-items8"> Clean white cloth (for altar or to cover offerings)</li>
                        </ul>
                    </div>

                    <h3 onclick="toggleChecklist('monday-morning')">üåÖ 1. Early Morning Preparation ‚ñº</h3>
                    <div id="monday-morning" class="collapsible-content ritual-list">
                        <ul>
                            <li><input type="checkbox" id="monday-prep1"> Wake up before sunrise (Brahma Muhurta)</li>
                            <li><input type="checkbox" id="monday-prep2"> Take a full bath (head bath preferred)</li>
                            <li><input type="checkbox" id="monday-prep3"> Wear clean, preferably white or light blue clothes</li>
                            <li><input type="checkbox" id="monday-prep4"> Clean your prayer space/altar thoroughly</li>
                            <li><input type="checkbox" id="monday-prep5"> Arrange all puja items neatly</li>
                        </ul>
                    </div>

                    <h3 onclick="toggleChecklist('monday-steps')">üôè 2. Rudra Puja Steps ‚ñº</h3>
                    <div id="monday-steps" class="collapsible-content ritual-list">
                        <ul>
                            <li><input type="checkbox" id="monday-step1"> Light the diya and incense to purify the space</li>
                            <li><input type="checkbox" id="monday-step2"> Sprinkle water on yourself (purification)</li>
                            <li><input type="checkbox" id="monday-step3"> Offer water/milk to Shivling or image (Abhishekam)</li>
                            <li><input type="checkbox" id="monday-step4"> Offer Bilva leaves and flowers while chanting</li>
                            <li><input type="checkbox" id="monday-step5"> Chant "Om Rudraya Namah" 108 times</li>
                            <li><input type="checkbox" id="monday-step6"> Offer fruits and light incense again</li>
                            <li><input type="checkbox" id="monday-step7"> Sit quietly in meditation for 5-10 minutes</li>
                            <li><input type="checkbox" id="monday-step8"> Close with prayer: "O Rudra, remover of darkness..."</li>
                        </ul>
                    </div>

                    <h3 onclick="toggleChecklist('monday-fasting')">üå± 3. Fasting Guidelines ‚ñº</h3>
                    <div id="monday-fasting" class="collapsible-content ritual-list">
                        <ul>
                            <li><input type="checkbox" id="monday-step9"> Observe full or partial fast (only fruits/milk)</li>
                            <li><input type="checkbox" id="monday-step10"> Avoid non-vegetarian food, alcohol, smoking</li>
                            <li><input type="checkbox" id="monday-step11"> Maintain calm demeanor throughout the day</li>
                            <li><input type="checkbox" id="monday-step12"> Perform acts of charity if possible</li>
                            <li><input type="checkbox" id="monday-step13"> Avoid negative speech and thoughts</li>
                            <li><input type="checkbox" id="monday-step14"> Break fast next morning after sunrise</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Tuesday-Sunday: Simple Checklist -->
            <div class="puja-checklist" id="regular-checklist" style="display: none;">
                <h2 onclick="toggleChecklist('regular')">üïâÔ∏è Daily Shiva Puja (Tuesday-Sunday) ‚ñº</h2>
                <div id="regular-content" class="collapsible-content">
                    <ul class="simple-checklist">
                        <li><input type="checkbox" id="regular-step1"> Chant "Om Gan Ganapataye Namaha" 3 times (for Ganesh)</li>
                        <li><input type="checkbox" id="regular-step2"> Offer water and milk to Shiva Linga (Abhishekam)</li>
                        <li><input type="checkbox" id="regular-step3"> Chant "Om Rudraya Namah" 108 times</li>
                        <li><input type="checkbox" id="regular-step4"> Sit quietly in meditation for 5 minutes</li>
                    </ul>
                </div>
            </div>
            
            <div id="mantra-chant-section">
                <h3>Chant Your Mantra (108 times)</h3>
                <select id="mantra-select"><option value="" disabled selected>Select a mantra</option></select>
                <div id="mantra-text"></div>
                <div id="chant-counter">Chants: 0 / 108</div>
                <button id="chant-button" disabled>Chant +1</button>
                <div id="chant-message"></div>
            </div>
            <button id="submit-btn">‚úÖ Submit Today's Progress</button>
            <button id="clear-btn">üßπ Clear Today's Data</button>
        </div>
    </div>

    <script>
        // Config
        const startDate = new Date('May 27, 2025'), durationDays = 21, targetDate = new Date('June 16, 2025 00:00:00');
        const mantras = [
            {id:"mahamrityunjaya",name:"Mahamrityunjaya Mantra",text:"Om Tryambakam Yajamahe Sugandhim Pushtivardhanam Urvarukamiva Bandhanan Mrityor Mukshiya Maamritat",count:108,meaning:"The great death-conquering mantra that grants longevity and immortality"},
            {id:"rudra",name:"Rudra Mantra",text:"Om Namo Bhagavate Rudraya",count:108,meaning:"Salutations to Lord Rudra, the fierce aspect of Shiva"},
            {id:"shivaya",name:"Om Namah Shivaya",text:"Om Namah Shivaya",count:108,meaning:"The five-syllable mantra meaning 'I bow to Shiva'"},
            {id:"shivastotra",name:"Shiva Stotra",text:"Namah Shivaya Shantaya Karunakaranaya Sarvajna Sarveshvaraya Rudraya Nilakanthaya",count:108,meaning:"Hymn praising Shiva's peaceful, compassionate and all-knowing nature"},
            {id:"shivagayatri",name:"Shiva Gayatri",text:"Om Tatpurushaya Vidmahe Mahadevaya Dhimahi Tanno Shiva Prachodayat",count:108,meaning:"Gayatri mantra for Shiva, the great divine purusha"}
        ];
        const quotes = [
            "Shiva is the infinite, the all-pervading, the eternal.",
            "Meditate on Shiva, the great transformer.",
            "In the heart of Shiva lies the power of the universe.",
            "Let the light of Shiva guide you through darkness.",
            "Devotion to Shiva brings peace and prosperity.",
            "Shiva is the destroyer of evil and the transformer.",
            "Through devotion to Shiva, ignorance is destroyed.",
            "Shiva is both the fire that burns and the water that cools.",
            "In Shiva's dance, the universe is created, preserved, and dissolved.",
            "Shiva's third eye represents the eye of wisdom and insight."
        ];
        const mondayChecklistIds = ['monday-prep1','monday-prep2','monday-prep3','monday-prep4','monday-prep5','monday-items1','monday-items2','monday-items3','monday-items4','monday-items5','monday-items6','monday-items7','monday-items8','monday-step1','monday-step2','monday-step3','monday-step4','monday-step5','monday-step6','monday-step7','monday-step8','monday-step9','monday-step10','monday-step11','monday-step12','monday-step13','monday-step14'];
        const regularChecklistIds = ['regular-step1','regular-step2','regular-step3','regular-step4'];
        const STORAGE_KEY_PREFIX = 'shiva-fast-day-', CHANT_STORAGE_KEY = 'shiva-fast-chant-done';

        // DOM Elements
        const els = {};
        ['calendar','day-title','mantra','quote','countdown','progress','day-info','mantra-select','mantra-text','chant-counter','chant-button','chant-message','submit-btn','clear-btn','monday-checklist','regular-checklist'].forEach(id => els[id] = document.getElementById(id));

        // State
        let today = new Date(); today.setHours(0,0,0,0);
        let currentDay = Math.min(Math.max(Math.floor((today - startDate)/(1000*60*60*24)) + 1, 1), durationDays);
        let dailyData = loadDayData(currentDay);
        let doneMantras = JSON.parse(localStorage.getItem(CHANT_STORAGE_KEY)) || {};

        // Initialize
        init();

        function init() {
            renderCalendar(); renderDayContent(currentDay); initPujaChecklist(); initMantraSelect(); updateProgress(); updateCountdown();
            setupEventListeners(); setInterval(updateCountdown, 1000);
            
            // Show appropriate checklist based on day of week
            const dayDate = new Date(startDate);
            dayDate.setDate(startDate.getDate() + currentDay - 1);
            if(dayDate.getDay() === 1) { // 1 = Monday
                els['monday-checklist'].style.display = 'block';
                els['regular-checklist'].style.display = 'none';
                // Expand the preparation section by default
                document.getElementById('monday-prepare').style.maxHeight = document.getElementById('monday-prepare').scrollHeight + 'px';
            } else {
                els['monday-checklist'].style.display = 'none';
                els['regular-checklist'].style.display = 'block';
            }
            
            // Initialize collapsible sections
            document.querySelectorAll('.collapsible-content').forEach(el => {
                if (!el.id.includes('prepare')) { // Don't collapse preparation section
                    el.style.maxHeight = el.scrollHeight + 'px';
                }
            });
        }

        function toggleChecklist(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.style.maxHeight = content.scrollHeight + 'px';
            } else {
                content.classList.add('collapsed');
                content.style.maxHeight = null;
            }
        }

        function renderCalendar() {
            els.calendar.innerHTML = '';
            for(let d=1; d<=durationDays; d++) {
                const dayDate = new Date(startDate); dayDate.setDate(startDate.getDate() + d - 1);
                const dayEl = document.createElement('div');
                dayEl.className = `calendar-day ${d < currentDay ? 'completed-day' : d === currentDay ? 'current-day' : 'future-day'}`;
                dayEl.innerHTML = `<div class="day-number">${dayDate.getDate()}</div><div style="font-size:0.7em;margin-top:2px">${dayDate.toLocaleDateString('en-US',{weekday:'short'})}</div><div class="month-name">${d<=5?'May':'June'}</div>`;
                if(d <= currentDay) dayEl.addEventListener('click', () => showDay(d));
                els.calendar.appendChild(dayEl);
            }
        }

        function renderDayContent(day) {
            const dayDate = new Date(startDate); dayDate.setDate(startDate.getDate() + day - 1);
            els['day-title'].textContent = `üìø Day ${day} of ${durationDays} (${dayDate.toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'})})`;
            els.mantra.textContent = mantras[day % mantras.length].text;
            els.quote.textContent = quotes[day % quotes.length];
            
            // Show appropriate checklist based on day of week
            if(dayDate.getDay() === 1) { // 1 = Monday
                els['monday-checklist'].style.display = 'block';
                els['regular-checklist'].style.display = 'none';
                // Expand the preparation section by default
                document.getElementById('monday-prepare').style.maxHeight = document.getElementById('monday-prepare').scrollHeight + 'px';
            } else {
                els['monday-checklist'].style.display = 'none';
                els['regular-checklist'].style.display = 'block';
            }
        }

        function initPujaChecklist() {
            // Initialize Monday checklist
            mondayChecklistIds.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.checked = dailyData.mondayChecklist ? dailyData.mondayChecklist[id] : false;
                    el.addEventListener('change', () => {
                        dailyData.mondayChecklist = dailyData.mondayChecklist || {};
                        dailyData.mondayChecklist[id] = el.checked;
                        saveDayData(currentDay, dailyData);
                        updateProgress();
                    });
                }
            });
            
            // Initialize Regular checklist
            regularChecklistIds.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.checked = dailyData.regularChecklist ? dailyData.regularChecklist[id] : false;
                    el.addEventListener('change', () => {
                        dailyData.regularChecklist = dailyData.regularChecklist || {};
                        dailyData.regularChecklist[id] = el.checked;
                        saveDayData(currentDay, dailyData);
                        updateProgress();
                    });
                }
            });
        }

        function initMantraSelect() {
            els['mantra-select'].innerHTML = '<option value="" disabled selected>Select a mantra</option>';
            mantras.forEach(m => {
                const option = document.createElement('option');
                option.value = m.id; option.textContent = m.name + (doneMantras[m.id] ? ' (completed)' : '');
                if(doneMantras[m.id]) option.disabled = true;
                els['mantra-select'].appendChild(option);
            });
            if(dailyData.chant && dailyData.chant.mantraId && !doneMantras[dailyData.chant.mantraId]) {
                els['mantra-select'].value = dailyData.chant.mantraId;
                updateMantraText(dailyData.chant.mantraId);
                els['chant-counter'].textContent = `Chants: ${dailyData.chant.count} / 108`;
                els['chant-button'].disabled = false;
            } else {
                els['mantra-text'].textContent = '';
                els['chant-counter'].textContent = 'Chants: 0 / 108';
                els['chant-button'].disabled = true;
            }
            els['chant-message'].textContent = '';
        }

        function updateMantraText(id) {
            const mantra = mantras.find(m => m.id === id);
            els['mantra-text'].textContent = mantra ? `${mantra.text}\n\nMeaning: ${mantra.meaning}` : '';
        }

        function setupEventListeners() {
            els['mantra-select'].addEventListener('change', () => {
                const selectedId = els['mantra-select'].value;
                if(doneMantras[selectedId]) return;
                updateMantraText(selectedId);
                els['chant-counter'].textContent = 'Chants: 0 / 108';
                els['chant-button'].disabled = false;
                els['chant-message'].textContent = '';
                dailyData.chant = {mantraId: selectedId, count: 0};
                saveDayData(currentDay, dailyData);
            });

            els['chant-button'].addEventListener('click', () => {
                if(!dailyData.chant) return;
                dailyData.chant.count = (dailyData.chant.count || 0) + 1;
                saveDayData(currentDay, dailyData);
                els['chant-counter'].textContent = `Chants: ${dailyData.chant.count} / 108`;
                if(dailyData.chant.count >= 108) {
                    els['chant-message'].textContent = `Mantra "${mantras.find(m => m.id === dailyData.chant.mantraId).name}" completed!`;
                    els['chant-button'].disabled = true;
                    doneMantras[dailyData.chant.mantraId] = true;
                    localStorage.setItem(CHANT_STORAGE_KEY, JSON.stringify(doneMantras));
                    
                    // Mark chanting as complete in both checklists
                    document.getElementById('monday-step5').checked = true;
                    document.getElementById('regular-step3').checked = true;
                    
                    dailyData.mondayChecklist = dailyData.mondayChecklist || {};
                    dailyData.mondayChecklist['monday-step5'] = true;
                    dailyData.regularChecklist = dailyData.regularChecklist || {};
                    dailyData.regularChecklist['regular-step3'] = true;
                    saveDayData(currentDay, dailyData);
                    updateProgress();
                    initMantraSelect();
                }
            });

            els['submit-btn'].addEventListener('click', () => {
                const dayDate = new Date(startDate);
                dayDate.setDate(startDate.getDate() + currentDay - 1);
                const isMonday = dayDate.getDay() === 1;
                
                let allCompleted = true;
                if(isMonday) {
                    allCompleted = mondayChecklistIds.every(id => dailyData.mondayChecklist && dailyData.mondayChecklist[id]);
                } else {
                    allCompleted = regularChecklistIds.every(id => dailyData.regularChecklist && dailyData.regularChecklist[id]);
                }
                
                if (!allCompleted) {
                    alert('Please complete all puja steps before submitting.'); return;
                }
                if (!isDayCompleted(currentDay)) {
                    markDayCompleted(currentDay);
                    updateProgress(); renderCalendar();
                    if (currentDay < durationDays) {
                        currentDay++; showDay(currentDay);
                        alert('Great progress! Moving to day ' + currentDay);
                    } else alert('Congratulations! You have completed all 21 days!');
                } else alert('This day is already marked as complete.');
            });

            els['clear-btn'].addEventListener('click', () => {
                if(confirm('Clear all data for today?')) {
                    clearDayData(currentDay); dailyData = {};
                    doneMantras = JSON.parse(localStorage.getItem(CHANT_STORAGE_KEY)) || {};
                    renderCalendar(); renderDayContent(currentDay);
                    initPujaChecklist(); initMantraSelect(); updateProgress();
                    els['chant-message'].textContent = '';
                }
            });
        }

        function isDayCompleted(day) {
            const dayData = loadDayData(day);
            const dayDate = new Date(startDate);
            dayDate.setDate(startDate.getDate() + day - 1);
            
            if(dayDate.getDay() === 1) { // Monday
                return mondayChecklistIds.every(id => dayData.mondayChecklist && dayData.mondayChecklist[id]);
            } else {
                return regularChecklistIds.every(id => dayData.regularChecklist && dayData.regularChecklist[id]);
            }
        }

        function markDayCompleted(day) {
            const dayData = loadDayData(day);
            const dayDate = new Date(startDate);
            dayDate.setDate(startDate.getDate() + day - 1);
            
            if(dayDate.getDay() === 1) { // Monday
                mondayChecklistIds.forEach(id => dayData.mondayChecklist = {...(dayData.mondayChecklist || {}), [id]: true});
            } else {
                regularChecklistIds.forEach(id => dayData.regularChecklist = {...(dayData.regularChecklist || {}), [id]: true});
            }
            saveDayData(day, dayData);
        }

        function saveDayData(day, data) { localStorage.setItem(STORAGE_KEY_PREFIX + day, JSON.stringify(data)); }
        function loadDayData(day) { return JSON.parse(localStorage.getItem(STORAGE_KEY_PREFIX + day)) || {}; }
        function clearDayData(day) { localStorage.removeItem(STORAGE_KEY_PREFIX + day); }

        function showDay(day) {
            currentDay = day; dailyData = loadDayData(currentDay);
            renderDayContent(currentDay); initPujaChecklist(); initMantraSelect();
            els['submit-btn'].disabled = isDayCompleted(currentDay);
            renderCalendar(); updateProgress();
            
            // Show appropriate checklist based on day of week
            const dayDate = new Date(startDate);
            dayDate.setDate(startDate.getDate() + currentDay - 1);
            if(dayDate.getDay() === 1) { // 1 = Monday
                els['monday-checklist'].style.display = 'block';
                els['regular-checklist'].style.display = 'none';
                // Expand the preparation section by default
                document.getElementById('monday-prepare').style.maxHeight = document.getElementById('monday-prepare').scrollHeight + 'px';
            } else {
                els['monday-checklist'].style.display = 'none';
                els['regular-checklist'].style.display = 'block';
            }
        }

        function updateProgress() {
            let completedDays = 0;
            for(let d=1; d<=durationDays; d++) if(isDayCompleted(d)) completedDays++;
            els.progress.style.width = (completedDays / durationDays) * 100 + '%';
            els['day-info'].textContent = `Day ${currentDay} of ${durationDays} | ${completedDays} days fully completed`;
        }

        function updateCountdown() {
            const now = new Date(), diff = targetDate - now;
            if(diff <= 0) { els.countdown.textContent = "üéâ Today is June 16, 2025!"; return; }
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            els.countdown.innerHTML = `‚è≥ Countdown to June 16, 2025: <br><span style="font-size:1.3em">${days}d ${hours}h ${minutes}m ${seconds}s</span>`;
        }
    </script>
</body>
</html>
